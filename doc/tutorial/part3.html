
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    

    <title>2.3. Remote Job Submission &mdash; SAGA 0.9.6 documentation</title>

<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/>


    
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/searchtools.js"></script>
    <link rel="top" title="SAGA 0.9.6 documentation" href="../index.html" />
    <link rel="up" title="2. Tutorial" href="index.html" />
    <link rel="next" title="2.4. Adding File Transfer" href="part4.html" />
    <link rel="prev" title="2.2. Local Job Submission" href="part2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="part4.html" title="2.4. Adding File Transfer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="part2.html" title="2.2. Local Job Submission"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">SAGA 0.9.6 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">2. Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="remote-job-submission">
<h1>2.3. Remote Job Submission<a class="headerlink" href="#remote-job-submission" title="Permalink to this headline">¶</a></h1>
<p>Next, we take the previous example and modify it, so that our job is executed on
a remote machine instead of localhost. This examples shows one of the
most important capabilities of SAGA: abstracting system heterogeneity. We can
use the same code we have used to run a job via &#8216;fork&#8217; with minimal
modifications to run a job on a different resource, e.g., via &#8216;ssh&#8217; on another
remote system or via &#8216;pbs&#8217; or &#8216;sge&#8217; on a remote cluster.</p>
<div class="section" id="prerequisites">
<h2>2.3.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This example assumes that you have SSH access to a remote resource, either a single host or an HPC cluster.</p>
<p>The example also assumes that you have a working public/private SSH key-pair and
that you can log-in to your remote resource of choice using those keys, i.e.,
your public key is in the ~/.ssh/authorized_hosts file on the remote machine. If
you are not sure how this works, you might want to read about
<a class="reference external" href="https://github.com/saga-project/saga-python/wiki/SSH-and-GSISSH">SSH and GSISSH</a>
first.</p>
</div>
<div class="section" id="hands-on-remote-job-submission">
<h2>2.3.2. Hands-On: Remote Job Submission<a class="headerlink" href="#hands-on-remote-job-submission" title="Permalink to this headline">¶</a></h2>
<p>Copy the code from the previous example to a new file saga_example_remote.py.
Add a <tt class="docutils literal"><span class="pre">saga.Context</span></tt> and <tt class="docutils literal"><span class="pre">saga.Session</span></tt> right before the <tt class="docutils literal"><span class="pre">job.Service</span></tt>
object initialization. Sessions and Contexts describe your SSH identity on the
remote machine:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ctx</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s">&quot;ssh&quot;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="s">&quot;oweidner&quot;</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</pre></div>
</div>
<p>To change the execution host for the job, change the URL in the <tt class="docutils literal"><span class="pre">job.Service</span></tt>
constructor. If you want to use a remote SSH host, use an <a class="reference external" href="ssh://">ssh://</a> URL. Note that
the session is passed as an additional parameter to the Service constructor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s">&quot;ssh://remote.host.net&quot;</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, if you have access to a PBS cluster, use a <tt class="docutils literal"><span class="pre">pbs+ssh://...</span></tt> URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s">&quot;pbs+ssh://remote.hpchost.net&quot;</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">ses</span><span class="p">)</span>
</pre></div>
</div>
<p>There are more URL options. Have a look at the <a class="reference internal" href="../adaptors/saga.adaptor.index.html#chapter-adaptors"><em>Adaptors</em></a> section
for a complete list. If you submitting your job to a PBS cluster (pbs+ssh://),
you will probably also have to make some modifications to your <tt class="docutils literal"><span class="pre">job.Description</span></tt>.
Depending on the configuration of your cluster, you might have to put in the
name of the queue you want to use or the allocation or project name that should
be credited:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jd</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">Description</span><span class="p">()</span>

<span class="n">jd</span><span class="o">.</span><span class="n">environment</span>     <span class="o">=</span> <span class="p">{</span><span class="s">&#39;MYOUTPUT&#39;</span><span class="p">:</span><span class="s">&#39;&quot;Hello from Bliss&quot;&#39;</span><span class="p">}</span>
<span class="n">jd</span><span class="o">.</span><span class="n">executable</span>      <span class="o">=</span> <span class="s">&#39;/bin/echo&#39;</span>
<span class="n">jd</span><span class="o">.</span><span class="n">arguments</span>       <span class="o">=</span> <span class="p">[</span><span class="s">&#39;$MYOUTPUT&#39;</span><span class="p">]</span>
<span class="n">jd</span><span class="o">.</span><span class="n">output</span>          <span class="o">=</span> <span class="s">&quot;mysagajob.stdout&quot;</span>
<span class="n">jd</span><span class="o">.</span><span class="n">error</span>           <span class="o">=</span> <span class="s">&quot;mysagajob.stderr&quot;</span>

<span class="n">jd</span><span class="o">.</span><span class="n">queue</span>           <span class="o">=</span> <span class="s">&quot;short&quot;</span> <span class="c"># Using a specific queue</span>
<span class="n">jd</span><span class="o">.</span><span class="n">project</span>         <span class="o">=</span> <span class="s">&quot;TG-XYZABCX&quot;</span> <span class="c"># Example for an XSEDE/TeraGrid allocation</span>
</pre></div>
</div>
<div class="section" id="run-the-code">
<h3>2.3.2.1. Run the Code<a class="headerlink" href="#run-the-code" title="Permalink to this headline">¶</a></h3>
<p>Save the file and execute it (<strong>make sure your virtualenv is activated</strong>):</p>
<div class="highlight-bash"><div class="highlight"><pre>python saga_example_remote.py
</pre></div>
</div>
<p>The output should look something like this:</p>
<div class="highlight-none"><div class="highlight"><pre>Job ID    : None
Job State : New

...starting job...

Job ID    : [ssh://gw68.quarry.iu.teragrid.org]-[18533]
Job State : Done

...waiting for job...

Job State : Done
Exitcode  : 0
</pre></div>
</div>
<p>Values marked as &#8216;None&#8217; could not be fetched from the backend, at that point.</p>
</div>
<div class="section" id="check-the-output">
<h3>2.3.2.2. Check the Output<a class="headerlink" href="#check-the-output" title="Permalink to this headline">¶</a></h3>
<p>As opposed to the previous &#8220;local&#8221; example, you won&#8217;t find a <tt class="docutils literal"><span class="pre">mysagajob.stdout</span></tt>
file in your working directory. This is because the file has been created on the
remote host were your job was executed. In order to check the content, you would
have to log-in to the remote machine. We will address this issue in the next
example.</p>
</div>
</div>
<div class="section" id="discussion">
<h2>2.3.3. Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<p>Besides changing the <tt class="docutils literal"><span class="pre">job.Service</span></tt> URL to trigger a different middleware
plug-in, we have introduced another new aspect in this tutorial example:
Contexts. Contexts are used to define security / log-in contexts for SAGA
objects and are passed to the executing plug-in (e.g., the SSH plug-in).</p>
<p>A context always has a type that matches the executing plug-in. The two most
commonly used contexts in SAGA are <tt class="docutils literal"><span class="pre">ssh</span></tt> and <tt class="docutils literal"><span class="pre">gsissh</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Your ssh identity on the remote machine</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">Context</span><span class="p">(</span><span class="s">&quot;ssh&quot;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="s">&quot;oweidner&quot;</span>
</pre></div>
</div>
<p>A Context can&#8217;t be used by itself, but rather has to be added to a
<tt class="docutils literal"><span class="pre">saga.Session</span></tt> object. A session can have one or more Contexts. At runtime,
SAGA Python will iterate over all Contexts of a Session to see if any of them
can be used to establish a connection.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">session</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">session</span><span class="o">.</span><span class="n">add_context</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, Sessions are passed as an extra parameter during object creation,
otherwise they won&#8217;t get considered:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">js</span> <span class="o">=</span> <span class="n">saga</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="s">&quot;ssh://remote.host.net&quot;</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">ses</span><span class="p">)</span>
</pre></div>
</div>
<p>The complete API documentation for Session and Context classes can be found
in the Library Reference section of this manual.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.3. Remote Job Submission</a><ul>
<li><a class="reference internal" href="#prerequisites">2.3.1. Prerequisites</a></li>
<li><a class="reference internal" href="#hands-on-remote-job-submission">2.3.2. Hands-On: Remote Job Submission</a><ul>
<li><a class="reference internal" href="#run-the-code">2.3.2.1. Run the Code</a></li>
<li><a class="reference internal" href="#check-the-output">2.3.2.2. Check the Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discussion">2.3.3. Discussion</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="part2.html"
                        title="previous chapter">2.2. Local Job Submission</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="part4.html"
                        title="next chapter">2.4. Adding File Transfer</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/part3.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="part4.html" title="2.4. Adding File Transfer"
             >next</a> |</li>
        <li class="right" >
          <a href="part2.html" title="2.2. Local Job Submission"
             >previous</a> |</li>
        <li><a href="../index.html">SAGA 0.9.6 documentation</a> &raquo;</li>
          <li><a href="index.html" >2. Tutorial</a> &raquo;</li> 
      </ul>
    </div>
<div class="footer">
    &copy; Copyright 2012, The SAGA Project.
  Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
  <br />Theme based on <a href="http://readthedocs.org/">Read The Docs</a>

</div>





  </body>
</html>